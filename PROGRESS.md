# Simple EQ Patcher - Development Progress

## Project Overview
Custom EverQuest patcher system with GUI launcher and automated patch distribution.

**Repository:** https://github.com/crucifix86/simple-eq-patcher

---

## âœ… Completed Features

### Server-Side Components

**1. Manifest Builder**
- Scans `/var/www/html/eq-patches` directory
- Generates `manifest.json` with MD5 hashes and file sizes
- Includes all files for distribution to players
- Built in Go for performance

**2. Automated Installer (`install.sh`)**
- Detects if running as root or regular user
- Auto-installs dependencies: Go, nginx, zip
- Builds server manifest-builder
- Creates `/var/www/html/eq-patches` directory
- Configures nginx to serve files
- Opens firewall port 80
- Generates client bundle ZIP automatically
- **NEW:** `--update` flag to pull latest from git and rebuild

**3. nginx Configuration**
- Serves files from `/var/www/html/eq-patches`
- Proper CORS headers for web access
- Cache control headers
- Security headers (X-Content-Type-Options)

**4. Client Distribution**
- Single ZIP file: `eq-patcher-client.zip` (~31MB)
- Contains: LaunchPad.exe, patcher.exe, patcher-config.json
- Available at: `http://YOUR_IP/eq-patches/eq-patcher-client.zip`

---

### Client-Side Components

**1. GUI Launcher (LaunchPad.exe)**
- Built with Fyne v2 GUI framework
- EverQuest-themed with loadscreen.jpg background
- Cross-compiled for Windows from Linux

**Features:**
- âœ… Auto-update check on startup (not on PLAY click)
- âœ… Launcher self-update detection
- âœ… Shows "X updates available" dialog
- âœ… User can choose to update or skip
- âœ… Progress bar with smooth 0-100% progression
- âœ… Status messages at every stage:
  - "Connecting to patch server..."
  - "âœ“ Connected - Checking files..."
  - "ğŸ“¥ Downloading filename (1/5)"
  - "âœ“ All files updated - Ready to play"
  - "ğŸ® Launching EverQuest..."
- âœ… Graphics Settings menu with resolution detection
- âœ… Compatibility Fix Wizard (DPI/fullscreen issues)
- âœ… Configurable website button
- âœ… Customizable launcher title and server name
- âœ… Play anyway if patch server unreachable
- âœ… Bold, larger text for better readability
- âœ… Obsolete file detection and removal (removes files deleted server-side)

**2. Graphics Settings**
- Traditional dropdown-based menu
- Resolution selector (queries Windows for available modes)
- Fullscreen toggle
- Texture Quality: Low/Medium/High/Ultra
- Spell Effects: Off/Low/Medium/High
- Advanced: Grass, Dynamic Lighting, Vertex/Pixel Shaders
- Automatically edits eqclient.ini
- Shows current INI values on open

**3. Compatibility Fix Wizard**
- Full Compatibility mode (best for fullscreen)
- DPI Awareness Only (best for windowed)
- Remove All Settings option
- Applies Windows registry settings automatically
- Replicates Apply_Compatibility_Fixes.bat functionality

**4. Path Handling**
- Launcher directory detection via `os.Executable()`
- Finds eqgame.exe in same folder as launcher
- Loads eqclient.ini from launcher directory
- Sets working directory for game launch

**5. CLI Patcher (patcher.exe)**
- Command-line fallback
- Same patching logic as GUI
- For troubleshooting or automation

---

## ğŸ—ï¸ Architecture

### Server Architecture
```
/var/www/html/eq-patches/
â”œâ”€â”€ manifest.json          â† Generated by manifest-builder
â”œâ”€â”€ LaunchPad.exe          â† GUI launcher
â”œâ”€â”€ patcher.exe            â† CLI fallback
â”œâ”€â”€ patcher-config.json    â† Pre-configured
â”œâ”€â”€ eq-patcher-client.zip  â† All-in-one bundle
â”œâ”€â”€ spells_us.txt          â† Your custom files
â”œâ”€â”€ UI/
â”‚   â””â”€â”€ default/
â”‚       â””â”€â”€ EQUI_*.xml
â””â”€â”€ update-patches.sh      â† Helper script
```

### Client Architecture
```
C:\EverQuest\
â”œâ”€â”€ eqgame.exe             â† Game executable
â”œâ”€â”€ LaunchPad.exe          â† Your launcher
â”œâ”€â”€ patcher.exe            â† CLI fallback
â”œâ”€â”€ patcher-config.json    â† Server config
â”œâ”€â”€ eqclient.ini           â† Graphics settings
â””â”€â”€ [patched files]        â† Downloaded from server
```

### Manifest Structure
```json
{
  "version": "1.0",
  "files": [
    {
      "path": "spells_us.txt",
      "md5": "abc123...",
      "size": 123456
    },
    {
      "path": "UI/default/EQUI_Inventory.xml",
      "md5": "def456...",
      "size": 45678
    }
  ]
}
```

---

## ğŸ”„ Update Workflows

### Server Admin Updates Patcher Code
```bash
cd simple-eq-patcher
./install.sh --update
cd /var/www/html/eq-patches
cp LaunchPad.exe patcher.exe patcher-config.json ./
./update-patches.sh
```

### Server Admin Updates Game Files
```bash
cd /var/www/html/eq-patches
cp /opt/eqemu/server/spells_us.txt .
cp /path/to/custom/zone.eqg .
./update-patches.sh
```

### Player Opens Launcher
1. Launcher checks for updates automatically
2. If launcher outdated: Shows notification with download link
3. If game files need update: Shows "X updates available" dialog
4. User chooses to update or skip
5. Downloads with progress bar
6. Click PLAY â†’ game launches

---

## ğŸ› Known Issues & Fixes

### Fixed Issues
1. âœ… IPv6 detection â†’ Now forces IPv4
2. âœ… Wrong nginx paths â†’ Fixed to /var/www/html/eq-patches
3. âœ… Missing mingw-w64 â†’ Now uses pre-compiled executables
4. âœ… Icon not showing â†’ Fixed with windres
5. âœ… Root user rejected â†’ Now works as root or regular user
6. âœ… Website button not showing â†’ Fixed URL check
7. âœ… Resolution list too generic â†’ Now queries actual display modes
8. âœ… Game path issues â†’ Uses launcher directory

### Current Issues
- None known at this time

---

## ğŸ“Š Build Information

**Server Build:**
- Language: Go
- Binary: manifest-builder (Linux)
- Size: ~10MB
- Build time: <5 seconds

**Client Build:**
- Language: Go + Fyne v2
- LaunchPad.exe: ~23MB (includes GUI framework + images)
- patcher.exe: ~7MB (CLI only)
- Build time: ~30 seconds (pre-compiled, included in git)

**Total Distribution Size:**
- Client bundle ZIP: ~31MB
- Includes all 3 files players need

---

## ğŸ¯ Design Decisions

### Why Manifest-based?
- Timestamp-based patching unreliable (timezone issues, clock skew)
- MD5 verification prevents corruption
- Size check catches partial downloads
- Single source of truth for all files

### Why Pre-compiled Executables?
- Faster installation (no mingw-w64 needed)
- Less error-prone (no build failures on VPS)
- Standard practice for software distribution
- Executables are tested and known to work

### Why Manual Launcher Updates?
- Can't replace running .exe on Windows
- Safer than self-update mechanisms
- User has full control
- Simple and reliable

### Why /var/www/html/eq-patches?
- Standard nginx document root
- No complex alias configurations
- Works with default nginx setup
- Simple URL structure

### Why Check Updates on Startup?
- Better UX than clicking PLAY and waiting
- Users see updates immediately
- Can choose to skip if in a hurry
- PLAY button becomes instant

---

## ğŸ“ Configuration

### Server Config (installer generates)
```json
{
  "server_url": "http://YOUR_IP/eq-patches",
  "server_name": "EverQuest Emulator Server",
  "launcher_title": "EverQuest LaunchPad",
  "website_url": "https://discord.gg/yourserver",
  "website_label": "Join Discord",
  "game_exe": "eqgame.exe",
  "game_args": "patchme"
}
```

### Customizable Fields
- `server_url` - Patch server location
- `server_name` - Displayed under title
- `launcher_title` - Window title
- `website_url` - Discord/forums URL
- `website_label` - Button text
- `game_exe` - Game executable name
- `game_args` - Launch arguments

---

## ğŸš€ Deployment

### Server Requirements
- Ubuntu 24.04 (tested, should work on others)
- Root or sudo access
- Internet connection
- Go compiler
- nginx web server
- zip utility

### Client Requirements
- Windows (any modern version)
- EverQuest installation
- Internet connection
- No admin rights needed (unless using Compatibility Fix)

### Network Requirements
- Port 80 open (HTTP)
- Or port 443 for HTTPS (manual nginx config)

---

## ğŸ“ˆ Future Enhancements (Potential)

### Not Yet Implemented
- [ ] HTTPS support (manual nginx config for now)
- [ ] Delta patching (only download changed parts)
- [ ] Bandwidth limiting
- [ ] Multiple mirrors
- [ ] Torrent distribution
- [ ] Automatic launcher self-update (Windows limitations)
- [ ] Download resume on failure
- [ ] Parallel downloads

### Won't Implement
- âŒ Complex YAML configs (keeping it simple)
- âŒ Multiple client types (one launcher for all)
- âŒ Automatic game launching after patch (user choice)

---

## ğŸ”§ Development Tools

### Build Script (`build.sh`)
```bash
./build.sh
```
Builds:
- server/manifest-builder (Linux)
- client/LaunchPad.exe (Windows)
- client/patcher.exe (Windows)
- client/patcher-linux (Linux, for testing)

Requires mingw-w64 for Windows builds (developers only)

### Install Script (`install.sh`)
```bash
./install.sh          # First time
./install.sh --update # Update to latest
```

### Update Helper (`update-patches.sh`)
Auto-generated in /var/www/html/eq-patches
```bash
./update-patches.sh
```
Regenerates manifest.json after adding files

---

## ğŸ“š Documentation

- README.md - Main documentation
- PROGRESS.md - This file (development summary)
- Comments in code - Implementation details

---

## ğŸ“ Technologies Used

**Languages:**
- Go (server + client)
- Bash (installer)

**Frameworks:**
- Fyne v2 (GUI)

**Tools:**
- mingw-w64 (cross-compilation)
- nginx (file serving)
- Git (version control)

**Libraries:**
- crypto/md5 (file verification)
- net/http (downloads)
- os/exec (game launching)

---

## ğŸ‘¥ Credits

Built with Claude Code assistance
Repository: https://github.com/crucifix86/simple-eq-patcher

---

*Last Updated: 2025-11-02*
